<!doctype html>
<html>
<head>
  <title>Street View split-map-panes</title>
</head>

<style>
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
  }

  #map-container {
    flex: 1;
    display: flex;
  }

  #map, #pano {
    flex: 1;
    height: 100%;
  }

  #controls {
    padding: 10px;
    text-align: center;
    background: #f1f1f1;
  }

  button {
    padding: 10px 20px;
    font-size: 16px;
    cursor: pointer;
  }
</style>

<body>
<div id="controls">
  <button id="submitButton">Submit Coordinates</button>
</div>
<div id="map-container">
  <div id="map"></div>
  <div id="pano"></div>
</div>
</body>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCE7_bfL1qF7QvFo9crvQ8v4wbslyufU1g&callback=initialize&v=weekly">
</script>

<script>
  let currentMarker = null; // To store the current marker's location

  function initialize() {
    const initialLocation = { lat: 42, lng: -71 };

    // Create the map with Street View control disabled
    const map = new google.maps.Map(document.getElementById("map"), {
      center: initialLocation,
      zoom: 8,
      streetViewControl: false, // Disable Pegman
      disableDefaultUI: true,  // Disable all default UI
    });

    // Create a single marker but do not set its position yet
    const marker = new google.maps.Marker({
      map: map,
      icon: "https://maps.google.com/mapfiles/ms/icons/red-dot.png", // Red pin icon
    });

    // Add an event listener to move the marker to the clicked location
    map.addListener("click", (event) => {
      const clickedLocation = event.latLng;

      // Move the existing marker to the new location
      marker.setPosition(clickedLocation);
      currentMarker = clickedLocation; // Update the current marker's location
    });

    // Create the panorama with address and info UI disabled
    const panorama = new google.maps.StreetViewPanorama(
            document.getElementById("pano"),
            {
              position: initialLocation,
              pov: {
                heading: 34,
                pitch: 10,
              },
              addressControl: false, // Disable address info
              linksControl: false,   // Disable navigation links
              panControl: false,     // Disable pan control
              zoomControl: false,    // Disable zoom control
            }
    );

    map.setStreetView(panorama);

    // Add a click event listener for the submit button
    document.getElementById("submitButton").addEventListener("click", () => {
      if (currentMarker) {
        const lat = currentMarker.lat();
        const lng = currentMarker.lng();
        console.log(`Coordinates: Latitude = ${lat}, Longitude = ${lng}`);
        // Example: Send data to Java using a hypothetical JavaScript bridge
        if (typeof java !== "undefined" && java !== null) {
          java.printCoordinates(lat, lng); // Call a Java function to print the coordinates
        }
      } else {
        console.log("No marker placed yet!");
      }
    });
  }

  window.initialize = initialize;
</script>

</html>
